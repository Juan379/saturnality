<% flash.each do |type, msg| %>
  <div>
    <%= msg %>
  </div>
<% end %> <br/>

<h1>Party: <%= @party.title %></h1>
<h2>Created by: <%= @party.user.name %></h2>
<h2>Description: <%= @party.description %></h2>
<h3>Address: <%= @party.address %></h3>
<h3>Comuna: <%= @party.comuna.name %></h3>
<h3>Capacity: <%= @party.capacity %></h3>
<h3>Cost: <%= @party.cost %></h3>
<% if @party.search %>
    <h3>Search state: On going</h3>
    <% if @party.user_id == current_user.id && @party.interesteds.count > 0 %>
        <%= button_to 'Close and notify', close_and_notify_party_path(@party.id), method: :post, class: 'btn primary' %>
    <% end %>
<% else %>
    <h3>Search state: Terminated</h3>
<% end %> <br/> 


<% if !@party.services.empty? %>
  <h3>Hired services:</h3> 

  <% @party.services.each do |service| %>
  <h3> > <%= link_to service.name, service_path(service) %></h3> <br/> 
  <% end %>

<% else %>
<h3>No services hired yet!</h3>
<% end %> 

<% if current_user  %>
    <% if @party.user_id == current_user.id %>
        <%= link_to "Hire service", services_path %> <br/> <br/> 
    <% end %>

    <% if @party.search && @party.user_id == current_user.id %>
        <% if !@party.interesteds.empty? %>
            <h3>Offers for your party:</h3><br>
            <% @party.interesteds.each do |interested| %>
            <h3>Name: <%= link_to  User.find(interested.user_id).name , user_path(User.find(interested.user_id).id) %></h3> <br/> 
        <% end %>
        <h3>There is a total of: $<%= how_much_money(@party) %> offered in you party</h3>

    <% else %>
        <h3>No postulations for your party yet!</h3>
    <% end %>  
<% end %>

    <% if !@party.search && @party.user_id == current_user.id %>
        <% if !@party.attendees.empty? %>
            <h3>Attendees for your party:</h3><br>
            <% @party.attendees.each do |attendee| %>
                <h3>Name: <%= link_to  User.find(attendee.user_id).name , user_path(User.find(attendee.user_id).id) %></h3> <br/> 
            <% end %>
        <% else %>
            <h3>No offers for your party yet!</h3>
        <% end %>
    <% end %>

<% end %>

<% if current_user  %>
    <% if @party.search && @party.user_id != current_user.id %>
        <% if user_is_interested(current_user, @party)   %>
            <% @party.interesteds.each do |interested| %>
                <% if interested.user_id == current_user.id   %>
                    <h3>Your actual offer is: $<%= interested.offer %>
                    <%= link_to "Edit", edit_interested_path(interested) %>
                    <%= link_to "Delete", interested, method: :delete, data: { confirm: "Do you really want to delete this interestation?"} %></h3> 
                <% end %>
            <% end %>    


        <% else  %>
            <h3>There are <%= how_much_interesteds(@party)%> interested in this party </h3>
            <h2>Like what you see?</h2>
            <p>Submit how much you would be willing to pay to attend this awesome party!</p>
            
            <%= form_with model: [ @party, @party.interesteds.build ], local: true do |form| %>
                <p><%= form.label :offer %></p>
                <p><%= form.number_field :offer %></p>
                <%= form.submit "Submit offer" %>
            <% end %>
        <% end %>
    <% end %>
<% else %>
        <h2>You need to be logged in to create a review.</h2>
<% end %>



</br>





